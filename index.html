<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Mapa Satélite / Calles con VIIRS TrueColor</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #map { height: 100vh; width: 100vw; }
    .leaflet-top.leaflet-left {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    .custom-btn {
      background: white;
      border: 1px solid #ccc;
      padding: 5px 10px;
      margin: 5px;
      cursor: pointer;
      border-radius: 4px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    function formatLocalDate(d) {
      const yyyy = d.getUTCFullYear();
      const mm = String(d.getUTCMonth() + 1).padStart(2, '0');
      const dd = String(d.getUTCDate()).padStart(2, '0');
      return `${yyyy}-${mm}-${dd}`;
    }

    const today = new Date();
    const dateStr = formatLocalDate(today);

    const streets = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap'
    });

    const modis = L.tileLayer(
      `https://gibs.earthdata.nasa.gov/wmts/epsg3857/best/MODIS_Aqua_CorrectedReflectance_TrueColor/default/${dateStr}/GoogleMapsCompatible_Level9/{z}/{y}/{x}.jpg`, {
      maxZoom: 9,
      attribution: 'NASA MODIS'
    });

    // Usa una capa VIIRS que sí está disponible en GIBS
    const viirsTrueColor = L.tileLayer(
      `https://gibs.earthdata.nasa.gov/wmts/epsg3857/best/VIIRS_SNPP_CorrectedReflectance_TrueColor/default/${dateStr}/GoogleMapsCompatible_Level9/{z}/{y}/{x}.jpg`, {
      maxZoom: 9,
      attribution: 'NASA VIIRS'
    });

    const map = L.map('map', {
      center: [0, 0],
      zoom: 2,
      layers: []
    });

    const hour = today.getHours();
    let satelliteLayer;
    if (hour >= 6 && hour < 18) {
      satelliteLayer = modis;
    } else {
      satelliteLayer = viirsTrueColor;
    }
    map.addLayer(satelliteLayer);

    const toggleBtn = L.control({position: 'topleft'});
    toggleBtn.onAdd = function() {
      const btn = L.DomUtil.create('button', 'custom-btn');
      btn.innerHTML = 'Cambiar a Calles';
      btn.onclick = function() {
        if (map.hasLayer(satelliteLayer)) {
          map.removeLayer(satelliteLayer);
          map.addLayer(streets);
          btn.innerHTML = 'Cambiar a Satélite';
        } else {
          map.removeLayer(streets);
          map.addLayer(satelliteLayer);
          btn.innerHTML = 'Cambiar a Calles';
        }
      };
      return btn;
    };
    toggleBtn.addTo(map);
  </script>
</body>
</html>



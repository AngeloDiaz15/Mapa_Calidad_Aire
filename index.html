<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Mapa Satélite (MODIS/VIIRS) + Calles</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html,body,#map {height:100%;margin:0;padding:0}
    .custom-button {
      position:absolute;
      top:10px;
      left:10px;
      z-index:1000;
      background:white;
      padding:6px 12px;
      border:1px solid #ccc;
      border-radius:4px;
      cursor:pointer;
      font-family:sans-serif;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <button class="custom-button" id="toggleBtn">Ver Calles</button>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
  (async function(){

    // ---- Funciones utilitarias ----
    function formatLocalDate(d){
      const y=d.getFullYear(), m=String(d.getMonth()+1).padStart(2,'0'), day=String(d.getDate()).padStart(2,'0');
      return `${y}-${m}-${day}`;
    }

    // ---- Configuración ----
    const mapCenter = [-9.2, -75.0]; // Perú
    const initialZoom = 4;
    const todayStr = formatLocalDate(new Date());

    // Capas base
    const modis = L.tileLayer(
      `https://gibs.earthdata.nasa.gov/wmts/epsg3857/best/MODIS_Aqua_CorrectedReflectance_TrueColor/default/${todayStr}/GoogleMapsCompatible_Level9/{z}/{y}/{x}.jpg`,
      { maxZoom: 9, attribution: "NASA MODIS Aqua TrueColor" }
    );

    const viirs = L.tileLayer(
      `https://gibs.earthdata.nasa.gov/wmts/epsg3857/best/VIIRS_SNPP_DayNightBand_At_Sensor_Radiance/default/${todayStr}/GoogleMapsCompatible_Level8/{z}/{y}/{x}.png`,
      { maxZoom: 8, attribution: "NASA VIIRS NOAA-20 Day/Night Band Radiance" }
    );

    const streets = L.tileLayer(
      "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
      { maxZoom: 19, attribution: "© OpenStreetMap contributors" }
    );

    // Selección día/noche
    const hour = new Date().getHours();
    let satelliteLayer = (hour >= 6 && hour < 18) ? modis : viirs;

    // Crear mapa con la capa satelital inicial
    const map = L.map("map", {
      center: mapCenter,
      zoom: initialZoom,
      layers: [satelliteLayer]
    });

    let showingStreets = false;
    const btn = document.getElementById("toggleBtn");

    btn.addEventListener("click", function(){
      if (showingStreets){
        map.removeLayer(streets);
        map.addLayer(satelliteLayer);
        btn.textContent = "Ver Calles";
        showingStreets = false;
      } else {
        map.removeLayer(satelliteLayer);
        map.addLayer(streets);
        btn.textContent = "Ver Satélite";
        showingStreets = true;
      }
    });

  })();
  </script>
</body>
</html>


